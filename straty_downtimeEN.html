<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Hello, world!</title>
</head>
<body>

<div class="container">

    <table class="table">
        <thead>
        <tr>
            <th scope="col">Parametry serwisu</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th scope="row">Wskaźnik konwersji</th>
            <td>
                <div class="input-group mb-3">
                    <input type="" id="conversion_rate" step="0,01" value="0.05" class="form-control" name="">
                    <span class="input-group-text">%</span>
                </div>
            </td>
        </tr>
        <tr>
            <th scope="row">Średnia wartosc koszyka</th>
            <td>
                <div class="input-group mb-3">
                    <input type="" id="avg_basket_value" step="0,01" value="200.00" class="form-control" name="">
                    <span class="input-group-text">zł</span>
                </div>
            </td>
        </tr>
        </tbody>
    </table>


    <!-- ------------------------------------------------ -->

    <table class="table">
        <tbody>
        <tr>
            <td></td>
            <td>miesiąc</td>
            <td>rok</td>
        </tr>
        <tr>
            <th scope="row">Ruch w serwisie</th>
            <td>
                <div class="input-group mb-3">
                    <input type="" id="traffic_month" step="0,01" value="30000" class="form-control" name="">
                </div>
            </td>
            <td>
                <div class="input-group mb-3">
                    <input type="" id="traffic_year" step="0,01" value="360000" class="form-control" name="">
                    <span class="input-group-text">zł</span>
                </div>
            </td>
        </tr>
        <tr>
            <th scope="row">Liczba konwersji</th>
            <td id="conversion_amount_month">15</td>
            <td id="conversion_amount_all">180</td>
        </tr>
        <tr>
            <th scope="row">Przychód</th>
            <td id="income_month">3 000,00 zł</td>
            <td id="income_all">36 000,00zł</td>
        </tr>
        </tbody>
    </table>

    <!-- ------------------------------------------------ -->

    <table class="table">
        <tbody>
        <tr>
            <td>uptime</td>
            <td>downtime</td>
            <td>miesiąc</td>
            <td>całość</td>
        </tr>
        <tr class="loses">
            <td data-percent="1" class="percent">100,00%</td>
            <td>-</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9999" class="percent">99,99%</td>
            <td>4,383 minut</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9990" class="percent">99,90%</td>
            <td>43,83 minut</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9980" class="percent">99,80%</td>
            <td>1 godzina i 27,66 minut</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9970" class="percent">99,70%</td>
            <td>2 godziny i 11,49 minut</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9950" class="percent">99,50%</td>
            <td>3 godziny i 39,15 minut</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9800" class="percent">98,00%</td>
            <td>14 godzin i 36,6 minut</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9700" class="percent">97,00%</td>
            <td>21 godzin i 54,9 minut</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9500" class="percent">95,00%</td>
            <td>1 dzień, 12 godzin i 31,5 min</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        <tr class="loses">
            <td data-percent="0.9000" class="percent">90,00%</td>
            <td>3 dni, 1 godzina i 3 minuty</td>
            <td class="month"></td>
            <td class="all"></td>
        </tr>
        </tbody>
    </table>

</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>

    var formatter = new Intl.NumberFormat('en-EN', {
        style: 'currency',
        currency: 'PLN',

        // These options are needed to round to whole numbers if that's what you want.
        //minimumFractionDigits: 0, // (this suffices for whole numbers, but will print 2500.10 as $2,500.1)
        //maximumFractionDigits: 0, // (causes 2500.99 to be printed as $2,501)
    });

    var number = new Intl.NumberFormat('en-EN', {
        // style: 'currency',
        // currency: 'PLN',

        // These options are needed to round to whole numbers if that's what you want.
        //minimumFractionDigits: 0, // (this suffices for whole numbers, but will print 2500.10 as $2,500.1)
        //maximumFractionDigits: 0, // (causes 2500.99 to be printed as $2,501)
    });

    function calculate(){
        let conversion_rate = $('#conversion_rate').val().replace(",", ".")/100;
        let avg_basket_value = $('#avg_basket_value').val().replace(",", ".");

        let traffic_month = $('#traffic_month').val().replace(",", ".");
        $('#traffic_year').val(  (traffic_month * 12).toFixed(0).replace(".", ",") );
        let traffic_year = $('#traffic_year').val().replace(",", ".");


        let conversion_amount_month = ( traffic_month*conversion_rate );
        let conversion_amount_all = ( traffic_year*conversion_rate );
        $('#conversion_amount_month').text( number.format(conversion_amount_month.toFixed(0)));
        $('#conversion_amount_all').text( number.format(conversion_amount_all.toFixed(0)));

        let income_month = avg_basket_value*conversion_amount_month;
        let income_all = avg_basket_value*conversion_amount_all;
        $('#income_month').text( formatter.format(income_month) );
        $('#income_all').text( formatter.format(income_all) );


        $( ".loses" ).each(function( index ) {
            let percent = $( this ).children(".percent").data('percent');

            $( this ).children(".month").text( formatter.format( (1-percent)*income_month ));
            $( this ).children(".all").text( formatter.format( (1-percent)*income_all ) );
        });

    }

    calculate();


    $("#traffic_year").on("change", function(){
        $('#traffic_month').val(  ($(this).val().replace(",", ".") / 12 ).toFixed(0).replace(".", ",") )
        calculate();
    });

    $("#conversion_rate,#avg_basket_value, #traffic_month").on("change", function(){
        calculate();
    });



    // Create our number formatter.


    // alert( formatter.format(12500.9) ); /* $2,500.00 */

</script>
</body>
</html>